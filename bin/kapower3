#!/bin/bash

# Kadeploy 3.1
# Copyright (c) by INRIA, Emmanuel Jeanvoine - 2008-2011
# CECILL License V2 - http://www.cecill.info
# For details on use and redistribution please refer to License.txt

if [ -x /etc/kadeploy3/load_kadeploy_env ] && [ -z "${KADEPLOY_CONFIG_DIR}" ]
then
    KADEPLOY_CONFIG_DIR=/etc/kadeploy3
    export KADEPLOY_CONFIG_DIR
elif [ ! -x $KADEPLOY_CONFIG_DIR/load_kadeploy_env ]
then
    echo "The Kadeploy environment cannot be loaded, please check your configuration"
    exit 1
fi

source $KADEPLOY_CONFIG_DIR/load_kadeploy_env

# Load the normal or async client
if [[ "$@" == *" --async "* ]]
then
  ruby $KADEPLOY_INSTALL_DIR/src/kapower_async.rb "${@//--async}"
else
  ruby $KADEPLOY_INSTALL_DIR/src/kapower.rb "$@"
fi
