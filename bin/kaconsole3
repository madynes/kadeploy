#!/usr/bin/ruby -w

$kadeploy_libs=ENV['KADEPLOY3_LIBS']||'/usr/local/kadeploy3/src/lib'

$:.unshift($kadeploy_libs)

require 'optparse'
require 'yaml'
require 'client'

Signal.trap("INT") do
  puts "\nSIGINT trapped, let's clean everything ..."
  Kadeploy::KaconsoleClient.kill() rescue nil
  exit!(1)
end

module Kadeploy

class KaconsoleClient < Client
  def self.operation()
    'Node console'
  end

  def self.load_options()
    global_load_options().merge(
      {
        :node => nil,
      }
    )
  end

  def self.parse_options()
    global_parse_options() do |opt,options|
      opt.separator "General options:"
      opt.on("-m", "--machine MACHINE", "Obtain a console on the given machine") { |h|
        tmp = []
        load_machine(tmp, h.strip)
        options[:node] = tmp[0]
      }
    end
  end

  def self.check_options(options)
    if !options[:node] or options[:node].empty?
      error("You must choose one node")
      return false
    end
    true
  end

  def run(options)
    raise 'Not implemented yet !'
  end
end

end

if __FILE__ == $0
  Kadeploy::KaconsoleClient.launch()
end
